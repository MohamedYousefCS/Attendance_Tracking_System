@model Student;
@{
    ViewData["Title"] = "showAttendance";
    Layout = "~/Views/Shared/MainLayout.cshtml";
}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <link rel="stylesheet" href="/css/AttendStudent.css" />
</head>

<body>
    <div class="container mt-5 px-2">

        <div class="containerInfo">
            <div style="border-radius:11px;display:flex;padding:17px;width:33%;justify-items:center;justify-content:space-around;" class="alert alert-danger">
                @ViewBag.absentDays Absent Days
            </div>
            <div style="border-radius:11px;display:flex;padding:17px;width:33%;justify-items:center;justify-content:space-around;" class="alert alert-warning">
                @ViewBag.lateDays late Days
            </div>
            <div style="border-radius:11px;display:flex;padding:17px;width:33%;justify-items:center;justify-content:space-around;" class="alert alert-info">
                CurrentDegree @ViewBag.tatalDegree
            </div>
        </div>

        <form id="attendanceForm">
            <div class="row">
                <div class="col">
                    <label for="date">Choose a date from:</label>
                    <input type="date" id="date" name="date" class="calender">
                </div>
                <div class="col">
                    <label for="date2">to:</label>
                    <input type="date" id="date2" name="date2" class="calender">
                </div>
                <div class="col" style="text-align:end">
                    <button type="submit" class="btn btn-primary">Go</button>
                </div>
            </div>
        </form>

        <div id="attendanceTableContainer"></div>

        </script>
        @section scripts {
            <script>
                    $(document).ready(function () {
                        const calender_inputs = document.querySelectorAll(".calender");
                        for (const input of calender_inputs) {
                            input.addEventListener("focus", () => {
                                input.type = 'date';
                                if (calender_inputs[0].value) {
                                    calender_inputs[1].min = calender_inputs[0].value;
                                }
                                input.showPicker();
                            })
                        }
                        calender_inputs[0].addEventListener("change", function () {
                            const selectedDate1 = new Date(calender_inputs[0].value);
                            const selectedDate2 = new Date(calender_inputs[1].value);
                            if (selectedDate2 < selectedDate1) {
                                calender_inputs[1].value = calender_inputs[0].value;
                            }

                            calender_inputs[1].min = calender_inputs[0].value;
                        });
                        
                        // Get today's date
                        var today = new Date();
                        // Format today's date as YYYY-MM-DD (required format for input type=date)
                        var formattedDate = today.toISOString().substr(0, 10);
                        // Set the value of the 'date2' input field to today's date
                        $("#date2").val(formattedDate);

                        $("#attendanceForm").submit(function (e) {
                            e.preventDefault(); // Prevent form submission
                            var formData = $(this).serialize(); // Serialize form data
                            $.ajax({
                                url: "@Url.Action("AttendanceData", "Student")", // Replace with your controller action
                                type: "GET",
                                data: formData,
                                success: function (result) {
                                    $("#attendanceTableContainer").html(result); // Update the partial view
                                },
                                error: function () {
                                    alert("An error occurred while fetching attendance data.");
                                }
                            });
                        });
                    });
            </script>
        }

    </div>
</body>

</html>
